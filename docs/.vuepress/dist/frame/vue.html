<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue | 学习笔记</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="xcc的备忘笔记">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.bd3a774d.js" as="script"><link rel="preload" href="/assets/js/2.591daaf2.js" as="script"><link rel="preload" href="/assets/js/19.f99ab3fa.js" as="script"><link rel="prefetch" href="/assets/js/10.3cb190c7.js"><link rel="prefetch" href="/assets/js/11.97d19dd3.js"><link rel="prefetch" href="/assets/js/12.807525a5.js"><link rel="prefetch" href="/assets/js/13.568dcd97.js"><link rel="prefetch" href="/assets/js/14.f361b042.js"><link rel="prefetch" href="/assets/js/15.fa8dcc41.js"><link rel="prefetch" href="/assets/js/16.d66bb3a4.js"><link rel="prefetch" href="/assets/js/17.c78ff984.js"><link rel="prefetch" href="/assets/js/18.31a74e1e.js"><link rel="prefetch" href="/assets/js/20.2cf38dce.js"><link rel="prefetch" href="/assets/js/21.afa2a950.js"><link rel="prefetch" href="/assets/js/22.ea1f3d58.js"><link rel="prefetch" href="/assets/js/23.1db48f7d.js"><link rel="prefetch" href="/assets/js/24.e82ba836.js"><link rel="prefetch" href="/assets/js/25.19af2c64.js"><link rel="prefetch" href="/assets/js/26.5b4e9966.js"><link rel="prefetch" href="/assets/js/27.ada649c4.js"><link rel="prefetch" href="/assets/js/28.81d1b5f0.js"><link rel="prefetch" href="/assets/js/29.a3f2fcef.js"><link rel="prefetch" href="/assets/js/3.05ec25a4.js"><link rel="prefetch" href="/assets/js/30.5b460bc7.js"><link rel="prefetch" href="/assets/js/31.51a84dc3.js"><link rel="prefetch" href="/assets/js/32.a823fa56.js"><link rel="prefetch" href="/assets/js/33.0a9df6f4.js"><link rel="prefetch" href="/assets/js/34.d19a0778.js"><link rel="prefetch" href="/assets/js/35.e4573d08.js"><link rel="prefetch" href="/assets/js/36.de6e2c3e.js"><link rel="prefetch" href="/assets/js/37.2487197e.js"><link rel="prefetch" href="/assets/js/38.120497d7.js"><link rel="prefetch" href="/assets/js/4.3b6a7e49.js"><link rel="prefetch" href="/assets/js/5.bc6e1aa4.js"><link rel="prefetch" href="/assets/js/6.29dc4fad.js"><link rel="prefetch" href="/assets/js/7.ea924bc2.js"><link rel="prefetch" href="/assets/js/8.ccecbc63.js"><link rel="prefetch" href="/assets/js/9.e583fadd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/front/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="https://github.com/2xxxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/front/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="https://github.com/2xxxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目和业务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/" aria-current="page" class="sidebar-link">框架架构</a></li><li><a href="/frame/vue.html" aria-current="page" class="active sidebar-link">vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/vue.html#vue的生命周期" class="sidebar-link">vue的生命周期</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#数据" class="sidebar-link">数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/vue.html#data" class="sidebar-link">data</a></li></ul></li><li class="sidebar-sub-header"><a href="/frame/vue.html#特殊属性" class="sidebar-link">特殊属性</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#双向绑定" class="sidebar-link">双向绑定</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#内置方法" class="sidebar-link">内置方法</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#vue组件通信" class="sidebar-link">vue组件通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/vue.html#minxins" class="sidebar-link">minxins</a></li></ul></li><li class="sidebar-sub-header"><a href="/frame/vue.html#vue-router" class="sidebar-link">vue-router</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#虚拟dom" class="sidebar-link">虚拟dom</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/vue.html#diff" class="sidebar-link">diff</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#methods" class="sidebar-link">methods</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#计算属性" class="sidebar-link">计算属性</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#监听属性" class="sidebar-link">监听属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/frame/vue.html#vue-ssr" class="sidebar-link">Vue SSR</a></li><li class="sidebar-sub-header"><a href="/frame/vue.html#指令" class="sidebar-link">指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/vue.html#自定义指令" class="sidebar-link">自定义指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/frame/vue.html#vue-cli" class="sidebar-link">vue-cli</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html和css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue"><a href="#vue" class="header-anchor">#</a> vue</h1> <p>vue是一个mvvm结构的框架。核心思想主要是组件化和数据驱动。<br>
优点：从复杂的dom操作中解放出来，由数据变化驱动页面视图更改，只要关心要显示操作哪些数据，要如何显示。</p> <h2 id="vue的生命周期"><a href="#vue的生命周期" class="header-anchor">#</a> vue的生命周期</h2> <p>总共8个，<br>
创建前后(beforeCreate,created)：处在实例化Vue的阶段，在_init方法中执行。该阶段没有渲染DOM,所以不能访问DOM。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span><span class="token string">'beforeCreate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initInjection</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化props、data、methods、watch、computed等属性  </span>
    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span><span class="token string">'created'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>挂载前后(beforeMount,mounted)： data有初始化,el没有、<br>
更新前后(beforeUpdate,updated)： 前（完成了el和data初始化，挂载虚拟dom），后（完成挂载，渲染）、<br>
销毁前后(beforeDestroy,destroyed)</p> <h2 id="数据"><a href="#数据" class="header-anchor">#</a> 数据</h2> <h3 id="data"><a href="#data" class="header-anchor">#</a> data</h3> <p>使用vue都要有一个vue 的根实例，vue的实例对象是其data属性值的代理。根的data属性是一个<strong>对象</strong>，组件内的data属性是<strong>函数</strong>。</p> <p>提问，<strong>为什么组件中data是函数</strong>？<br>
对象是引用类型，当复用组件时，由于数据对象指向同一个data,一个组件修改data会造成其他复用组件的data同时修改，使用函数的话，每次都会返回不同的对象。</p> <p><code>this.变量 === this._data.变量(this.$data.变量)</code>。ps:<code>_</code>前缀一般是表示私有属性，以<code>_</code>或<code>$</code>开头的是vue<strong>内置的property、API方法</strong>，为了将内置属性名与开发人员自定义的属性名区分开，一旦自定义以这个开头将不会被Vue实例代理，以免发生冲突。<br>
在vue中，data中定义的变量都可以通过this访问到。<br>
原理是：vue在初始化的过程中对data做一层代理(通过重写get，set方法)，递归将Data的property转换为getter/setter,从而让data的property能响应数据变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
   data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>vm<span class="token punctuation">)</span> <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token comment">//----------</span>
   <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length  
   <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       cionst key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
       <span class="token comment">//---------</span>
       <span class="token comment">//关键  </span>
       <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  

<span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span>object<span class="token punctuation">,</span> sourcekey<span class="token operator">:</span>string<span class="token punctuation">,</span> key<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// 关键</span>
 <span class="token punctuation">}</span>
 sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val  <span class="token comment">// 关键</span>
 <span class="token punctuation">}</span>
 Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>

</code></pre></div><h2 id="特殊属性"><a href="#特殊属性" class="header-anchor">#</a> 特殊属性</h2> <ul><li><p>key<br>
取值：<code>number | string | boolean(2.4.2)|symbol(2.5.12)</code>
key可以管理可复用元素，主要用在vue的虚拟DOM算法，在新旧nodes对比时辨别Vndes。这样vue在渲染时可以复用已有元素，而不是重新渲染，加快了渲染速度。<br>
该特性在有些时候不符合实际需求，当你需要某个标签重新渲染时，就将该标签的key值修改。<br>
有相同父元素的子元素要有独特的key,不然重复的key会造成渲染错误</p></li> <li><p>ref<br>
ref被用来给元素或子组件注册引用信息，引用信息会注册在父组件的$refs对象上<br>
注意：ref是作为渲染结果被创建的，在初始渲染时不能访问它们，因为还不存在；$refs也不是响应式的，因此不能在模板中做数据绑定</p></li></ul> <h2 id="双向绑定"><a href="#双向绑定" class="header-anchor">#</a> 双向绑定</h2> <p>原理: 采用数据劫持结合发布者-订阅者模式的方式，通过Object.defineProperty()来劫持各个属性的setter和getter,在数据变动时发布消息给订阅者，触发相应的监听回调。</p> <p>流程：</p> <ol><li>实现一个数据监听器Observer,能够对数据所有属性进行监听，如有变动可拿到最新值并且通知订阅者。</li> <li>实现一个指令解析器Compile,对每个元素节点的指令进行扫描和解析，根据指令模板替换数据，以及绑定相应的更新函数。</li> <li>实现一个Watcher，作为连接Observer和Compile的桥梁，能订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数，从而更新视图。</li> <li>mvvm入口函数，整合以上三者。
具体方法：</li> <li>getAttribute获取属性，正则收集指令</li> <li>指令添加处理函数</li> <li>data内的对象用defineProperty监听，在变化时进行拦截。</li> <li>检测到数据变化后更新对应的DOM节点</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>str<span class="token punctuation">'</span></span> <span class="token attr-name">onkeyup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>func()<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>spans<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>{{text.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>   

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">// function func() {</span>
    <span class="token comment">//     let str = document.getElementById('str').value;  </span>
    <span class="token comment">//     text.name = str;</span>

    <span class="token comment">// }  </span>
    <span class="token comment">// function fun1() {</span>
    <span class="token comment">//     let spannode = document.getElementById('spans');</span>
    <span class="token comment">//     spannode.innerText = text.name </span>
    <span class="token comment">// }</span>
    <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>  
        <span class="token comment">//取出所有属性遍历</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">definekey</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">definekey</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//监听子属性</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//可枚举</span>
            configurable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">//不能再define</span>
            <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> val
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newval<span class="token punctuation">)</span> <span class="token keyword">return</span>
                val <span class="token operator">=</span> newval<span class="token punctuation">;</span>
                dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//通知所有订阅者</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>  
    <span class="token keyword">function</span> <span class="token function">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Dep</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">addSub</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">notify</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>受javaScript限制，Vue无法检测到对象的属性添加或删除。Vue在初始化实例时会对属性执行getter/setter转化，所以属性必须在data对象上存在才能转换为响应式的。后续对象再新增响应式属性需要使用Vue提供的<code>Vue.$set(object,propName,value)</code>方法。<br>
vm.$set的实现原理：</p> <ul><li>如果目标是数组，直接使用数组的splice方法触发响应式；</li> <li>如果目标是对象，会先判断属性是否存在、对象是否是响应式，最终决定是否进行响应式处理，通过调用defineRective方法(利用Object.defineProperty动态给对象属性添加getter和setter的功能)进行响应式处理</li></ul> <h2 id="内置方法"><a href="#内置方法" class="header-anchor">#</a> 内置方法</h2> <ul><li>nextTick：在下次DOM循环更新后执行的延迟回调<br>
用法： 在修改数据后使用这个方法，获取更新后的DOM。<br>
原理：Vue是异步更新DOM的，在修改数据后，视图不会立即更新，而是等同一个事件循环(执行栈中的同步任务)中所有数据变化完成后再统一更新<br>
流程：</li></ul> <ol><li>（1）修改数据，都是同步任务，还未涉及到DOM。（2）开启一个异步队列，缓冲事件循环中的数据变化，如果同一个watcher被多次触发，只会被推入到队列中一次。</li> <li>同步任务执行完后，执行异步watcher队列的队列来更新DOM。Vue在内部对异步队列使用原生的Promise.then和MessageChannel方法，如果执行环境不支持，就使用setTimeout(fn,0)代替。</li> <li>DOM更新结束后，通过nextTick获取到改变后的DOM。</li></ol> <h2 id="vue组件通信"><a href="#vue组件通信" class="header-anchor">#</a> vue组件通信</h2> <ol><li><p><strong>props/$emit</strong>
父组件A通过props向子组件B传递，子组件向父组件通过子组件中的$emit，父组件中的v-on实现</p></li> <li><p><strong>$emit/$on</strong>
通过一个空的Vue实例作为中央事件总线来触发事件和监听事件，可以实现任意组件间的通信。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ebus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ebus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
ebus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
ebus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//在组件销毁是可取消响应，以免冲突</span>
</code></pre></div><ol start="3"><li><p><strong>Vuex</strong><br>
是vue的状态管理器，集中存储管理所有组件的状态，Vuex实现了一个单向数据流，在全局拥有一个State存放数据，当组件要更改State中数据时，必须通过Mutation(commit，同步)修改，异步操作或者批量同步操作则使用Action(dispatch),但Action也是通过Mutation修改State中的数据。最后根据state数据渲染到视图上。getters是State对象的读取方法。<br>
Vuex存储的数据是响应式的，但是不会保存起来，刷新页面后就会回到初始状态，要想刷新后保存，需要存储在localStorage中（只支持字符串，需要JSON转换）。</p></li> <li><p><strong>$parent/$children与ref</strong><br>
ref: 在普通DOM上使用，引用指向的就是DOM元素，在子组件上使用，就是指向组件实例。<br>
$parent/$children: 访问父/子实例</p></li> <li><p><strong>provide和inject</strong><br>
应用场景：当父组件有一个方法fn，它的子组件A，子组件的子组件B,子组件的子组件的子组件c都要使用这个方法，A要访问是用<code>this.$parent.fn()</code>,B要访问是<code>this.$parent.$parent.fn()</code>,c要访问是用<code>this.$parent.$parent.$paren.fn()</code>,如果嵌套很多层访问就很麻烦，这时候就能在父组件中使用<code>provide</code>来提供被访问的函数，子组件就使用<code>inject</code>导入父组件的函数。<br>
使用：<br>
provide取值：一个对象或是返回一个对象的函数<br>
inject取值：一个字符串数组或是一个对象（对象的key是本地的绑定名）</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// A</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">provide</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            fn<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//B</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
    

</code></pre></div><p>还有其他通信方法，不常用就没列举。</p> <h3 id="minxins"><a href="#minxins" class="header-anchor">#</a> minxins</h3> <p>minxins是一种实现功能复用的方式，可以定义共用的变量，在组件中使用。<br>
使用：先定义一个包含需要复用的组件选项的对象，将混入对象导出，在需要复用的组件中导入混入对象，把混入对象混入到当前组件中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//定义混入对象</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> myMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            text<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
<span class="token comment">//将混入对象混入到当前组件中</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>myMixin<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/assets/mixin.js'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    mixins<span class="token operator">:</span> <span class="token punctuation">[</span>myMixin<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre></div><p>特点：</p> <ol><li>方法和参数在各组件间不共享，组件内修改不会相互影响。</li> <li>值为对象的选项，像methods,components这些，选项会合并，如果有冲突，组件中的会覆盖掉混入对象中的。</li> <li>值为函数的选项，像created,mounted等，会被合并调用，先调用混入对象里钩子函数内的方法，再调用组件内钩子函数的。<br>
区别：</li></ol> <ul><li>与vuex对比，vuex是做状态管理，里面的变量每个组件都能访问和修改，是相互影响的。</li> <li>与公共组件对比，公共组件中父组件单独开辟一块独立空间给子组件，使用props传值，本质上两者是独立的；而mixins则是在组件原有的对象和方法上进行扩展，融为一体。</li></ul> <h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> vue-router</h2> <p>hash和history模式的区别:<br>
vue默认hash模式，url改变时页面不会重新加载</p> <p><strong>hash模式</strong><br>
基于location.hash(#后的内容)实现的。<br>
特性：</p> <ul><li>URL中hash值只是客户端的一种状态，也就是当向服务器发送请求时，hash部分不会被发送。</li> <li>hash值的改变会在浏览器中添加历史记录，可以通过浏览器前进后退来控制hash切换</li> <li>通过a标签设置href属性，用户点击标签后，hash值会改变；js中对location.hash赋值，也会使之改变；</li> <li>hash模式是通过改变锚点(#)来更新页面URL，并不会触发页面重新加载，我们可以通过window.onhashchange监听到hash的改变，从而处理路由。</li></ul> <p><strong>history模式</strong><br>
HTML5提供的History API来实现URL的变化。其中最主要的API是<code>history.pushState()</code>和<code>history.replaceState()</code>,这两个API可以在不刷新的情况下，操作浏览器的历史记录。不同的是，前一个是新增历史记录，后一个是替换当前历史记录。<br>
特性：</p> <ul><li>通过调用window.history对象上的一系列方法（pushState和replaceState）来实现URL变化</li> <li>使用popstate事件来监听url变化，从而对页面进行无刷新跳转</li> <li>history.pushState()或history.replaceState()不会触发popstate事件，这时我们需要手动触发页面跳转。</li></ul> <h2 id="虚拟dom"><a href="#虚拟dom" class="header-anchor">#</a> 虚拟dom</h2> <p>虚拟dom是根据真实dom提炼出的简单树状对象，将真实dom中的属性简化如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    tag<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>  <span class="token comment">//标签名  </span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment">//属性数据，包括class,style,event,props,attrs等  </span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//子节点数组，也是vnode结构  </span>
    text<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token comment">//文本</span>
    elm<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  <span class="token comment">//真实dom,旧的Vnode指向真实的node,新的Vnode指向undefined</span>
    key<span class="token operator">:</span> <span class="token keyword">undefined</span>  <span class="token comment">//节点标识</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Vue是由数据驱动视图，当某个数据修改时，视图在修改部分进行局部刷新。想要精准的找到视图就需要拿到数据改变前后的dom结构，找到差异并更新。</p> <h3 id="diff"><a href="#diff" class="header-anchor">#</a> diff</h3> <p>diff实现主要通过两个方法：patchVnode和updateChildren。</p> <p>虚拟dom比较：将新节点和旧节点做比较，对差异打补丁(patchVnode)。节点比较时，如果不相似则新建一个节点，如过相似则先对比节点data属性里的字段，有不同的就调用update函数进行更新，再是对子节点进行比较,如果在比较过程中找到了相似的childVnode,则递归进入新的打补丁的过程。</p> <p>源码实现：</p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">var</span> elm<span class="token punctuation">,</span>parent<span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//若相似就打补丁   </span>
           <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span>vnode<span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token comment">//不相似，直接覆盖  </span>
           elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>  
           parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>  
           <span class="token keyword">if</span><span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
               <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span><span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  

   <span class="token keyword">function</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//判断新旧vnode，比较tag和key是否一致</span>
       <span class="token keyword">return</span> a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span>tag <span class="token operator">===</span> b<span class="token punctuation">.</span>tag<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  

   <span class="token comment">//打补丁</span>
   <span class="token keyword">function</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//新节点引用旧节点的dom  </span>
       <span class="token keyword">let</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
       <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>  
       <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>

       <span class="token comment">//调用update钩子,打补丁就是调用update函数，更新真实dom的属性  </span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">updateAttrs</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">updateClass</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">updateEventListener</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">updateProps</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">updateStyle</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">//update函数实例  </span>
       <span class="token keyword">function</span> <span class="token function">updateAttrs</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">let</span> key<span class="token punctuation">,</span>cur<span class="token punctuation">,</span>old
           <span class="token keyword">const</span> oldAttrs <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>attrs <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
           <span class="token keyword">const</span> attrs <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>attrs <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

           <span class="token comment">//更新/添加属性 . 遍历vnode属性，如果和oldVnode不一样就调用setAttribute;</span>
           <span class="token keyword">for</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               cur <span class="token operator">=</span> attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
               old <span class="token operator">=</span> oldAttrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>old <span class="token operator">!==</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token keyword">if</span><span class="token punctuation">(</span>booleanAttrsDict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> cur <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                       <span class="token comment">//判断是否在布尔类型的属性字典中，例如async,autoplay,checked,autofocus等需要先移除该属性。</span>
                       elm<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                       <span class="token comment">//新增，更新</span>
                       elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> cur<span class="token punctuation">)</span>
                   <span class="token punctuation">}</span>
               <span class="token punctuation">}</span> 
           <span class="token punctuation">}</span>

           <span class="token comment">//删除新节点不存在的属性. 遍历oldVnode属性，如果不在vnode属性中就调用removeAttribute删除</span>
           <span class="token keyword">for</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> oldAttrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> attrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   elm<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>

       <span class="token comment">//判断是否为文本节点 ，如果是就不考虑子节点的比较</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//如果不是：</span>
            
           
           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>Ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 1.新旧节点都有children,那就进入子节点比较(diff);</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>oldCn <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//2.新节点有children，旧节点没有，那就循环创建dom节点  </span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//3.新节点没有children,旧节点有，就循环删除dom节点 </span>
               <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
           <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre></div><h3 id="methods"><a href="#methods" class="header-anchor">#</a> methods</h3> <p>methods会被混入到vue实例中，可以通过vm实例访问里面的方法，方法中的this自动绑定为vue实例</p> <h3 id="计算属性"><a href="#计算属性" class="header-anchor">#</a> 计算属性</h3> <p>变量需要进行复杂的逻辑操作时，可使用计算属性，它可以像绑定普通property一样在模板中绑定。<br>
通常我们可以将同一函数定义为方法methods，也可以定义为计算属性computed，两个方式的结果是一样的。但是不同的是，计算属性会<strong>基于响应式依赖进行缓存</strong>，也就是说，只有该属性依赖的响应式数据发生改变时，计算属性才会重新求值，否则计算属性就会回复上次缓存的值，不会再次执行函数。而方法methods是<strong>每次调用时都会执行函数</strong>。所以，当不需要缓存时，就用方法来代替计算属性。<br>
提问，为什么计算属性要缓存呢？<br>
为了节省计算开销，适用于计算量大或者修改频率低的情况。如果有一个计算属性要遍历庞大的数组且有大量计算，而其他计算属性又依赖于该属性时，没有缓存，会要多次执行该属性的getter。</p> <p>计算属性的实现：<br>
computed初始化、首次渲染、触发更新<br>
过程：</p> <ul><li>首次渲染时实例化computeedWather并定义属性dirty: false,在render过程中求值并进行依赖收集</li> <li>当computedWather订阅的响应式数据改变时，触发computedWatcher更新，修改dirty: true</li> <li>render函数执行时读取计算属性，发现dirty为true就重新求值，并更新页面视图。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//1.定义_computedWatchers。首先定义一个watcher空对象，挂在vm._computedWatchers上，用来存放vm实例的所有computedWather</span>
<span class="token keyword">function</span> <span class="token function">initComputed</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> computed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> watchers <span class="token operator">=</span> vm<span class="token punctuation">.</span>_computedWathers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历computed选项，依次定义</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> getter <span class="token operator">=</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//2.实例化computedWather,为计算属性创建内部watcher</span>
        watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wather</span><span class="token punctuation">(</span>
            vm<span class="token punctuation">,</span>
            getter <span class="token operator">||</span> noop<span class="token punctuation">,</span> 
            noop<span class="token punctuation">,</span>
            computedWatcherOptions <span class="token comment">//{lazy:true},指定lazy属性，表示要实例化的是computedWatcher</span>

        <span class="token punctuation">)</span>
        <span class="token comment">//3.为计算属性定义getter</span>
        <span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span>key<span class="token punctuation">,</span>userDef<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实例化computedWather</span>
<span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// options是{lazy: true}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>lazy
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token comment">//lazy watcher,初始为true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> expOrFn<span class="token punctuation">;</span>
        <span class="token comment">//lazy为true的话，不进行求值，直接返回undefined</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//对dep的响应式数据进行依赖收集，</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//dirty为true,表示要重新计算</span>
        <span class="token punctuation">}</span>
        <span class="token function">queueWather</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//加入异步更新队列，最终会执行render函数来生成vnode，同首次渲染一样，触发getter</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
<span class="token comment">//wather对象</span>
<span class="token comment">// {</span>
<span class="token comment">//     xxx: Watcher {</span>
<span class="token comment">//         lazy: true,</span>
<span class="token comment">//         dirty: true,</span>
<span class="token comment">//         deps:[],</span>
<span class="token comment">//         getter: function() {</span>
<span class="token comment">//             return ...</span>
<span class="token comment">//         },</span>
<span class="token comment">//         value: undefined</span>
<span class="token comment">//     }</span>
<span class="token comment">// }</span>

<span class="token comment">// 定义计算属性getter</span>
<span class="token keyword">function</span> <span class="token function">defineComputed</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWathers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>computedWathers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//dirty为true,执行get进行求值,并将dirty设置为false</span>
                    watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> wather<span class="token punctuation">.</span>value
                
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//进行更新</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由上述可知，computedWather主要是修改dity属性为true,计算属性依赖的响应式数据a被会computedWatcher订阅，即数据a的dep会收集该computedWatcher，一旦发生变化，就会触发computedWather更新，dirty置为true,重新求值；若是依赖数据没有变化，则不会触发更新，dirty仍为false，render不会重新求值，这样就起到了缓存的作用</p> <h3 id="监听属性"><a href="#监听属性" class="header-anchor">#</a> 监听属性</h3> <p>当需要在数据变化时执行异步或开销较大的操作时，适合用watch来响应数据的变化，例如页面中搜索框实时搜索等可以适用。<br>
watch允许执行异步操作，限制操作频率，并在得到最终结果前设置中间状态。</p> <h2 id="vue-ssr"><a href="#vue-ssr" class="header-anchor">#</a> Vue SSR</h2> <p>SSR是什么？<br> <strong>服务端渲染</strong>。由服务端来根据标签渲染成整个html片段，再直接返回给客户端。<br> <strong>优点</strong></p> <ol><li>更好的SEO，搜索引擎的爬虫工具可以直接查看完全渲染的页面。</li> <li>解决首屏加载速度过慢的问题。<br> <strong>缺点</strong></li> <li>开发条件受限。SSR目前只支持beforeCreate和created生命周期钩子函数，有些代码可能需要特殊处理</li> <li>构建设置和部署要求更高。以前的完全静态单页面程序（SPA）可以部署在任何静态文件服务器上，而SSR需要处于Node.js server环境下</li> <li>更多的服务器负载</li></ol> <h2 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h2> <h3 id="自定义指令"><a href="#自定义指令" class="header-anchor">#</a> 自定义指令</h3> <p>目的: 对普通的DOM元素进行底层操作</p> <h2 id="vue-cli"><a href="#vue-cli" class="header-anchor">#</a> vue-cli</h2> <p>基于Vue.js进行快速开发的完整系统，实现交互式的项目脚手架</p> <p>配置：</p> <ul><li>proxyTable:设置后可以实现开发环境下跨域</li></ul> <p>vue-cli配置优化</p> <ol><li>preload. 指定页面加载后很快会被用到的资源（js、css文件）.<code>&lt;link rel=&quot;preload&quot;&gt;</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//移除preload插件</span>
        config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'prefetch'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>prefetch.告诉浏览器在页面加载完成后，利用空闲时间提前获取用户未来可能会访问的内容</li> <li>处理静态资源。<br>
（1）从相对路径导入。在js、css或.vue文件中使用相对路径引用静态资源时，这类引用会被webpack处理，可以减少http请求数量。放在public目录下或通过绝对路径则会直接拷贝<br>
4.图片压缩。在vue.config.js中使用image-webpack-loader.执行很长的loader可以在之前使用cache-loader缓存下来</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/2/2020, 4:17:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frame/" class="prev router-link-active">
        框架架构
      </a></span> <span class="next"><a href="/dataStruct/">
        数据结构
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bd3a774d.js" defer></script><script src="/assets/js/2.591daaf2.js" defer></script><script src="/assets/js/19.f99ab3fa.js" defer></script>
  </body>
</html>
