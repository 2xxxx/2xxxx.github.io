<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP 和 UDP | 学习笔记</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="xcc的备忘笔记">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.5e8e0d0b.js" as="script"><link rel="preload" href="/assets/js/2.591daaf2.js" as="script"><link rel="preload" href="/assets/js/32.a2e5080f.js" as="script"><link rel="prefetch" href="/assets/js/10.7c0d70b3.js"><link rel="prefetch" href="/assets/js/11.3e7f150a.js"><link rel="prefetch" href="/assets/js/12.246acfd5.js"><link rel="prefetch" href="/assets/js/13.ecd37c84.js"><link rel="prefetch" href="/assets/js/14.4b966884.js"><link rel="prefetch" href="/assets/js/15.463fe875.js"><link rel="prefetch" href="/assets/js/16.d66bb3a4.js"><link rel="prefetch" href="/assets/js/17.c9fe3d80.js"><link rel="prefetch" href="/assets/js/18.48b90990.js"><link rel="prefetch" href="/assets/js/19.8402a335.js"><link rel="prefetch" href="/assets/js/20.ebedc4b0.js"><link rel="prefetch" href="/assets/js/21.afa2a950.js"><link rel="prefetch" href="/assets/js/22.ea1f3d58.js"><link rel="prefetch" href="/assets/js/23.101c1e24.js"><link rel="prefetch" href="/assets/js/24.2abf05f2.js"><link rel="prefetch" href="/assets/js/25.346d3dd2.js"><link rel="prefetch" href="/assets/js/26.219a71e9.js"><link rel="prefetch" href="/assets/js/27.ee2cab32.js"><link rel="prefetch" href="/assets/js/28.3ee93111.js"><link rel="prefetch" href="/assets/js/29.c64ccbb5.js"><link rel="prefetch" href="/assets/js/3.271b7d81.js"><link rel="prefetch" href="/assets/js/30.5b460bc7.js"><link rel="prefetch" href="/assets/js/31.6b330f1d.js"><link rel="prefetch" href="/assets/js/33.a7eebbc8.js"><link rel="prefetch" href="/assets/js/34.d19a0778.js"><link rel="prefetch" href="/assets/js/35.e4573d08.js"><link rel="prefetch" href="/assets/js/36.6b30a226.js"><link rel="prefetch" href="/assets/js/37.89703212.js"><link rel="prefetch" href="/assets/js/4.3b6a7e49.js"><link rel="prefetch" href="/assets/js/5.bc6e1aa4.js"><link rel="prefetch" href="/assets/js/6.29dc4fad.js"><link rel="prefetch" href="/assets/js/7.6d77f350.js"><link rel="prefetch" href="/assets/js/8.409c27ea.js"><link rel="prefetch" href="/assets/js/9.b9f2e740.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/front/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="https://github.com/2xxxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/front/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="https://github.com/2xxxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>网络基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/" aria-current="page" class="sidebar-link">网络基础</a></li><li><a href="/network/OSI.html" class="sidebar-link">OSI七层模型</a></li><li><a href="/network/DNS.html" class="sidebar-link">DNS</a></li><li><a href="/network/TCPandUDP.html" aria-current="page" class="active sidebar-link">TCP 和 UDP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/TCPandUDP.html#tcp" class="sidebar-link">TCP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/TCPandUDP.html#三次握手" class="sidebar-link">三次握手</a></li><li class="sidebar-sub-header"><a href="/network/TCPandUDP.html#四次挥手" class="sidebar-link">四次挥手</a></li></ul></li><li class="sidebar-sub-header"><a href="/network/TCPandUDP.html#udp" class="sidebar-link">UDP</a></li><li class="sidebar-sub-header"><a href="/network/TCPandUDP.html#对比" class="sidebar-link">对比</a></li></ul></li><li><a href="/network/http.html" class="sidebar-link">http协议</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目和业务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp-和-udp"><a href="#tcp-和-udp" class="header-anchor">#</a> TCP 和 UDP</h1> <p>TCP和UDP是传输层很重要的了两个协议，主要用于两节点之间数据的传输。</p> <h2 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h2> <p>TCP全称为传输控制协议，是一个面向连接的，可靠的，基于字节流的协议。<br>
TCP包结构：</p> <ol><li>源端口号和目的端口号；</li> <li>序列号（seq）:每一个字节一个序号，确保了TCP传输的有序性，比如，一个报文段序号为300，报文端数据部分有100字节，那下一个报文段的序号就为400.</li> <li>确认号 (ack) ：指明收到了下一个字节序号，表明数据准确收到了，只有值为1时才有效</li> <li>SYN: 同步序号，用于建立连接过程。</li> <li>FIN: finish标志，用于释放连接，为1时表示没有数据发送了，关闭本方数据流</li> <li>16位窗口大小：滑动窗口大小，最大65535</li> <li>16位TCP校验和、16位紧急指针</li> <li>选项、数据(可选)</li></ol> <p>特点：</p> <ul><li><p>面向连接。面向连接是指两节点要经过三次握手连接后才能传输数据。</p></li> <li><p>可靠。可靠是指TCP协议会确保数据传输的完整，如果有丢失则会重发。</p></li> <li><p>流量控制。解决当接收端缓存区已满无法处理更多数据，而发送端还在继续发送，造成丢包的问题。<br>
1.<code>RTT算法</code>（Round Trip Time 环回时间：一个数据包发出到回来的时间）。<br>
2.<code>滑动窗口</code>。<br>
当发送端发送数据给接收端时，接收端回复确认消息时会包含接收窗口(rwnd)大小，如果是剩余大小为0，发送端则停止发送，直到接收端处理完数据，剩余空间大于0，就通知发送端可以继续发送，为了避免接收端发送的通知丢失，发送端无法确认是否能继续发送的情况发生，发送端会每隔一段时间去询问接收端是否窗口大于0，如果是则继续发送，否则继续等待。滑动窗口最大为<code>min(rwnd, cwnd)</code>。</p></li> <li><p>拥塞控制。当网络发生拥塞时，TCP会减少网络传输数据的速度和数量，缓解阻塞。<br>
1.慢启动、拥塞避免。<br>
这两种方法是在拥塞发生之前，增加拥塞窗口(cwnd)大小。<br> <code>慢启动</code>算法是从小到大增加拥塞窗口大小去探测网络拥塞程度,呈指数增长，速度快。<br>
算法核心:初始为1，每收到一个ACK则cwnd++，每经过一个RTT则cwnd=cwnd*2,当cwnd &gt;= ssthresh时（通常ssthresh = 65535），进入拥塞避免算法。<br> <code>拥塞避免</code>算法呈线性增长，速度慢，在不造成拥塞的情况下，找到cwnd的最优值。<br>
算法核心：每收到一个ACK,则cwnd=cwnd+1/cwnd(cwnd&gt;1时无增长)，每经过一个RTT则cwnd++</p> <p>2.快重传、快恢复。<br>
这两种是拥塞发生时的处理及恢复的处理，当发送端发现发送包失败了，就认为网络阻塞了。<br>
丢包后，有两种重传方式：<br>
1.超时重传。<br>
算法核心：ssthresh = cwnd/2, cwnd = 1,重新进入慢启动。<br>
2.快速重传。<br>
算法核心：ssthresh = cwnd/2, cwnd = cwnd/2,进入拥塞避免算法。</p> <p><code>快重传</code>是当接收端收到乱序的数据包时，会重复回复上一个包的确认信息，如果发送端连续收到三条重复的确认信息，则立即重发丢失的包。例如，发送端发送M1，接收端回复确认M1，若此时发送端发送M2丢失了，发送端再发送M3，M4，M5，接收端都是重复确认M1，发送端就会重发M2。<br> <code>快恢复</code>是指当发送端收到三条重复信息时将ssthresh值减半，将cwnd设置为新的ssthresh的值，执行拥塞避免算法。</p></li></ul> <h3 id="三次握手"><a href="#三次握手" class="header-anchor">#</a> 三次握手</h3> <p>TCP连接需要经历三次握手：</p> <ol><li>客户端发送连接请求给服务端</li> <li>服务端接收到后发送确认信息给客户端</li> <li>客户端接收后再发送报文给服务端建立连接</li></ol> <p>提问，两次握手可以吗？<br>
不行，因为TCP三次握手也是为了确认客户端与服务器的发送能力和接收能力正常，第一次握手证明了客户端发送能力正常，第二次握手证明服务端的接收和发送能力正常，第三次握手是为了证明客户端接收能力正常。少了任意一环都无法确认。</p> <p>提问，握手过程中可以携带数据吗？<br>
第三次握手的时候可以，因为第三次握手时客户端已经处于建立连接状态，服务端的接收及发送能力也是正常状态。第一次和第二次不行，因为可能会让服务器受到攻击。</p> <h3 id="四次挥手"><a href="#四次挥手" class="header-anchor">#</a> 四次挥手</h3> <p>TCP关闭连接需要进行四次挥手：</p> <ol><li>客户端发送关闭连接的请求给服务端</li> <li>服务端回复确认消息给客户端</li> <li>服务端发送完数据后，回复给客户端关闭连接的消息</li> <li>客户端收到后发送关闭消息给服务端，并在等待2MSL后关闭连接</li></ol> <p>提问，为什么需要四次挥手？<br>
因为客户端发送关闭请求时服务端有可能还有数据没有发送完，所以会先告诉客户端收到关闭请求了，但是需要先把所有数据发送完，才会回复客户端可以关闭连接了。</p> <p>提问，为什么客户端要等待2MSL再断开连接？<br>
为了防止报文丢失，服务端无法收到客户端要断开连接的消息。MSL是指一个报文段的最大生存时间，如果发送的报文丢失，服务端确认超时及请求重发最大需要2MSL。</p> <h2 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h2> <p>UDP全称为用户数据报文协议。是一种无连接的，不可靠的协议。<br>
特点：</p> <ul><li>无连接。UDP在发送数据前无需进行三次握手连接，可以直接发送，且不会对数据报文进行任何拆分、拼接处理。</li> <li>不可靠性。发送数据时不会关心对方是否有收到，且没有流量控制和拥塞控制，当网络不好时，很容易造成丢包的情况。在实时性要求高，比如直播、视频会议等情况下，具有优势。</li></ul> <h2 id="对比"><a href="#对比" class="header-anchor">#</a> 对比</h2> <table><thead><tr><th></th> <th>TCP</th> <th>UDP</th></tr></thead> <tbody><tr><td>是否连接</td> <td>是</td> <td>否</td></tr> <tr><td>是否可靠</td> <td>可靠</td> <td>不可靠</td></tr> <tr><td>连接对象个数</td> <td>一对一</td> <td>一对一、一对多、多对一、多对多</td></tr> <tr><td>传输方式</td> <td>面向字节流</td> <td>面向报文</td></tr> <tr><td>首部开销</td> <td>最小20字节，最大60字节</td> <td>只有8字节，传输报文更高效</td></tr> <tr><td>使用场景</td> <td>文件传输等可靠传输</td> <td>实时性要求高的场景</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/1/2020, 10:56:11 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/network/DNS.html" class="prev">
        DNS
      </a></span> <span class="next"><a href="/network/http.html">
        http协议
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5e8e0d0b.js" defer></script><script src="/assets/js/2.591daaf2.js" defer></script><script src="/assets/js/32.a2e5080f.js" defer></script>
  </body>
</html>
